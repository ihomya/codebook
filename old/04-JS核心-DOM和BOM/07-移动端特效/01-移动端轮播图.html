<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- user-scalable=no 解决click事件的300ms延迟问题 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no">
    <title>Document</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            height: 1000px;
        }

        .focus {
            position: relative;
            /* padding-top: 44px; */
            overflow: hidden;
        }

        .focus img {
            width: 100%;
        }

        .focus ul {
            overflow: hidden;
            width: 500%;
            margin-left: -100%;
        }

        .focus ul li {
            float: left;
            width: 20%;
        }

        .focus ol {
            position: absolute;
            bottom: 5px;
            right: 5px;
            margin: 0;
        }

        .focus ol li {
            display: inline-block;
            width: 5px;
            height: 5px;
            background-color: #fff;
            list-style: none;
            border-radius: 2px;
            transition: all .3s;
        }

        .focus ol li.current {
            width: 15px;
        }

        .top {
            height: 200px;
            background-color: pink;
        }

        .main {
            height: 200px;
            background-color: skyblue;
        }

        .goback {
            display: none;
            position: fixed;
            right: 20px;
            bottom: 200px;
            width: 30px;
            height: 30px;
            background-color: #ccc;
            border-radius: 15px;
            text-align: center;
            line-height: 30px;
        }
    </style>
    <script>
        window.addEventListener('load', function () {
            /* 
                1. 自动播放功能
                2. 开启定时器
                3. 移动端 使用translate移动
            */
            var focus = document.querySelector('.focus');
            var ul = focus.children[0];
            var ol = focus.children[1];

            var w = focus.offsetWidth;

            // 复制第一张和最后一张图片
            var first = ul.children[0].cloneNode(true);
            var last = ul.children[ul.children.length - 1].cloneNode(true);
            ul.appendChild(first);
            ul.insertBefore(last, ul.children[0])

            // 1. 利用定时器 做自动播放
            var index = 0;
            var timer = setInterval(function () {
                // console.log(index);
                index++;
                var translatex = -index * w;
                ul.style.transition = 'all .3s'
                ul.style.transform = 'translateX(' + translatex + 'px)';
            }, 2000);
            // 等到过渡完成之后，再判断 监听过渡完成的事件 transitionend
            ul.addEventListener('transitionend', function () {
                // 2. 无缝滚动
                if (index >= ul.children.length - 2) {
                    index = 0;
                    // 去掉过渡效果 这样让我们的ul 快速跳到目标位置
                    ul.style.transition = 'none';
                    var translatex = -index * w;
                    ul.style.transform = 'translateX(' + translatex + 'px)';
                } else if (index < 0) {
                    index = 2;
                    // 去掉过渡效果 这样让我们的ul 快速跳到目标位置
                    ul.style.transition = 'none';
                    var translatex = -index * w;
                    ul.style.transform = 'translateX(' + translatex + 'px)';
                }
                // 3. 小圆圈变化
                ol.querySelector('.current').classList.remove('current');
                ol.children[index].classList.add('current')
            });

            /* 4. 手指滑动轮播图 */
            var startX = 0;
            var moveX = 0;
            var flag = false; // 用于判断用户是否移动屏幕
            ul.addEventListener('touchstart', function (e) {
                startX = e.targetTouches[0].pageX;
                clearInterval(timer);
            });

            ul.addEventListener('touchmove', function (e) {
                // 触摸移动距离
                moveX = e.targetTouches[0].pageX - startX;

                // 移动盒子：原坐标 + 触摸移动距离
                var translatex = -index * w + moveX;
                // 取消过渡效果
                ul.style.transition = 'none';
                ul.style.transform = 'translateX(' + translatex + 'px)';
                flag = true;
            });

            // 手指离开 根据移动距离判断播放下一张还是上一张
            ul.addEventListener('touchend', function () {
                if (flag) {
                    // （1）如果移动距离大于50px 则播放下一张或者上一张
                    if (Math.abs(moveX) > 50) {
                        // 右滑 播放上一张 moveX > 0  左滑 播放上一张 moveX < 0
                        moveX > 0 ? index-- : index++;
                        var translatex = -index * w;
                        ul.style.transition = 'all .3s';
                        ul.style.transform = 'translateX(' + translatex + 'px)';
                    } else {
                        // (2) 如果移动距离小于50像素我们就回弹
                        var translatex = -index * w;
                        ul.style.transition = 'all .1s';
                        ul.style.transform = 'translateX(' + translatex + 'px)';
                    }
                }
                clearInterval(timer);
                timer = setInterval(function () {
                    // console.log(index);
                    index++;
                    var translatex = -index * w;
                    ul.style.transition = 'all .3s'
                    ul.style.transform = 'translateX(' + translatex + 'px)';
                }, 2000);
            });
            // 5. goback模块
            var main = document.querySelector('.main');
            var goback = document.querySelector('.goback');
            window.addEventListener('scroll', function () {
                if (window.pageYOffset >= main.offsetTop) {
                    goback.style.display = 'block';
                } else {
                    goback.style.display = 'none';
                }
            });
            goback.addEventListener('click', function () {
                window.scroll(0, 0)
            })
        })
    </script>
</head>

<body>
    <div class="focus">
        <ul>
            <li><a href="javascript:;"><img src="./images/focus1.jpg" alt=""></a></li>
            <li><a href="javascript:;"><img src="./images/focus2.jpg" alt=""></a></li>
            <li><a href="javascript:;"><img src="./images/focus3.jpg" alt=""></a></li>
        </ul>
        <ol>
            <li class="current"></li>
            <li></li>
            <li></li>
        </ol>
    </div>
    <div class="top"></div>
    <div class="main"></div>
    <div class="goback">↑</div>
</body>

</html>